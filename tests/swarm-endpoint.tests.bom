brooklyn.catalog:
  version: "2.0.0-SNAPSHOT"
  iconUrl: https://raw.githubusercontent.com/docker-library/docs/471fa6e4cb58062ccbf91afc111980f9c7004981/swarm/logo.png
  license_code: CLOUDSOFT-1.0

  items:

  ###
  # Tests that we can deploy to a pre-provision docker swarm end point
  #
  # Needs a location of the form below
  #
  # location:
  #   jclouds:docker:
  #     endpoint: https://10.10.10.10:3376/
  #     identity: /path/to/.docker/machine/machines/manager/server.pem
  #     credential: /path/to/.docker/machine/machines/manager/server-key.pem
  #     imageId: sha256:90d5884b1ee07f7f791f51bab92933943c87357bcd2fa6be0e82c48411bbb653
  #     loginUser: root
  #     loginUser.password: p4ssw0rd
  #     onbox.base.dir: /tmp
  ##

  - id: docker-swarm-test
    name: Docker swarm test
    description: Test that we can provision a container on a docker swarm endpoint
    item:

      services:
      - type: org.apache.brooklyn.entity.software.base.EmptySoftwareProcess
        id: empty
        brooklyn.config:
          onbox.base.dir.skipResolution: true
          sshMonitoring.enabled: false

      - type: org.apache.brooklyn.test.framework.TestCase
        brooklyn.config:
          timeout: 15m
          targetId: empty
        name: Empty Container Tests
        brooklyn.children:
        - type: org.apache.brooklyn.test.framework.TestCase
          name: "Sensor Tests"
          brooklyn.children:
          # Is up and can deploy
          - type: org.apache.brooklyn.test.framework.TestSensor
            name: TEST [service.state] IS [running]
            target: $brooklyn:component("empty")
            sensor: service.state
            assert:
            - matches: running
          # Can ssh
          - type: ssh-test
            command: echo hello-world
            assertStatus:
              equals: 0
            assertOut:
              contains: hello-world
            assertErr:
              isEmpty: true
