brooklyn.catalog:
  version: "2.1.0-SNAPSHOT" # CONTAINER_SERVICE_VERSION
  iconUrl: https://raw.githubusercontent.com/docker-library/docs/471fa6e4cb58062ccbf91afc111980f9c7004981/swarm/logo.png
  dependsOn:
    - tests/common.tests.bom
    - tests/application.tests.bom
  license_code: CLOUDSOFT-1.0

##
# Needs a location named location-container similar to jclouds.tests.bom
# for the containers, using a pre-existing swarm, and the VMs will be created
# on the default application location in each cloud.
#
# brooklyn.catalog:
#   id: location-container
#   itemType: location
#   item:
#     type: docker
#     brooklyn.config:
#       endpoint: https://54.155.185.23:3376
#       identity: /home/ubuntu/.certs/swarm/cert.pem
#       credential: /home/ubuntu/.certs/swarm/key.pem
#       waitForSshable: false
#       loginUser: root
#       loginUser.password: p4ssw0rd
#       user: root
#       password: p4ssw0rd
#       templateOptions:
#         networkMode: "brooklyn" # the default swarm network
##

##
#Test assumtions
# * swarm endpoint preconfigured
# * cloudsoft/ubuntu:14.04 image has been pulled


  items:
    - id: swarm-endpoint-tests
      name: "Swarm Endpoint Deployment Tests"
      description: |
        Tests containers and applications can be deployed to both Swarm and
        Cloud locations
      itemType: template
      item:
        brooklyn.config:
          timeout: 1h
          timeout.initialStartup: 1h
          timeout.runtimeAssertion: 1h

        services:
          - type: test-case
            name: "1. Deploy Container Type Tests"
            brooklyn.children:
              - type: deploy-single-container-type
          - type: test-case
            name: "2. Deploy Blueprint Application Tests"
            brooklyn.config:
              dontRequireTtyForSudo: true
            brooklyn.children:
              - type: test-case
                name: "2.1. Single-Node Application Test"
                brooklyn.children:
                  - type: deploy-app-to-swarm-single-node
              - type: test-case
                name: "2.2. Multi-Node Application Test"
                brooklyn.children:
                  - type: deploy-riak-cluster-to-swarm-multi-node
                  - type: deploy-multi-node-app-swarm
              - type: test-case
                name: "2.3 Hybrid Multi-Node Application"
                brooklyn.children:
                  - type: deploy-multi-node-app-swarm-to-cloud
                  - type: deploy-multi-node-app-cloud-to-swarm